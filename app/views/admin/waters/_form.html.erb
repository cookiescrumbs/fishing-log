<script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
<script type="text/javascript">
  var marker;
  var map;

  function getLatitude() {
    if(document.getElementById('latitude').value.length > 0 ) {
      return document.getElementById('latitude').value
    }
    return 54.43869834845736
  }

  function getLongitude() {
    if(document.getElementById('longitude').value.length > 0 ) {
      return document.getElementById('longitude').value
    }
    return -2.2472353515624945
  }

  function updateMarkerPosition(latLng) {
    var lat = latLng.lat();
    var lng = latLng.lng();
    document.getElementById('latitude').value = lat;
    document.getElementById('longitude').value = lng;
    $('#display-latitude').text(lat);
    $('#display-longitude').text(lng);
  }

  function initialize() {
    var latitude  = getLatitude();
    var longitude = getLongitude();

    var latLng = new google.maps.LatLng(latitude,longitude);
    var map = new google.maps.Map(document.getElementById('form-map'), {
      zoom: 15,
      center: latLng,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    });
    var marker = new google.maps.Marker({
      position: latLng,
      map: map,
      draggable: true
    });

    // Update current position info.
    updateMarkerPosition(latLng);
    // Add dragging event listeners.
    google.maps.event.addListener(marker, 'drag', function() {
      updateMarkerPosition(marker.getPosition());
    });
  }
  // Onload handler to fire off the app.
  google.maps.event.addDomListener(window, 'load', initialize);
</script>

<div id="form-map" class="pull-right"></div>

<div class="pull-left">
<%= form_for([:admin,  @fishery, @water], :html => {:role => "form"}) do |f| %>
  <% if @water.errors.any? %>
    <div class="alert alert-danger">
      <strong><%= pluralize(@water.errors.count, "error") %> prohibited this water from being saved:</strong>
        <ul>
        <% @water.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
        </ul>
    </div>
  <% end %>
  <div class="form-group">
    <label for="water_name">Water Name</label>
    <%= f.text_field :name, class: "form-control", placeholder: "Enter water name" %>
  </div>

  <div class="form-group">
    <label for="water_latitude">Latitude</label>
    <div id="display-latitude"></div>
    <%= f.hidden_field :latitude, class: "form-control", id:"latitude", placeholder: "latitude" %>
  </div>

  <div class="form-group">
    <label for="water_longitude">Longitude</label>
    <div id="display-longitude"></div>
    <%= f.hidden_field :longitude, class: "form-control", id:"longitude", placeholder: "longitude" %>
  </div>

  <div class="form-group">
    <label for="water_species">Fish species</label>
    <%= collection_check_boxes(:water, :species_ids, Species.all, :id, :name) do |b| %>
    <div class="checkbox">
      <%= b.check_box %>
      <%= b.label %>
    </div>
    <% end %>
  </div>

  <div class="form-group">
    <%= button_tag "Submit", class: "btn btn-primary" %>
  </div>
<% end %>
</div>