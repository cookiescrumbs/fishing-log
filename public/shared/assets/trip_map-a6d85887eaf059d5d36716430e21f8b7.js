$(document).ready(function(){function e(e){var a=$("#event-temp").html(),o=Mustache.render(a,e.properties),i=e.styles.id,n=e.styles.count,r=e.styles.timeline,d=e.id+1,s='<div class="timeline-image '+n+'"><h1>'+d+"</h1></div>",l='<li id="'+i+'" class="'+r+'">'+s+o+"</li>";$(l).appendTo("ul.timeline"),t(e)}function t(e){$.fn.editable.defaults.mode="inline";var t=e.styles.id,a=e.feature;$("#"+t+" h4.date-time").editable({type:"combodate",format:"MMMM Do YYYY, h:mm a",template:"MMMM Do YYYY, h:mm a",combodate:{minYear:2015,maxYear:2016,minuteStep:15},success:function(e,t){a.setProperty("dateTime",t.format())}}),$("#"+t+" h4.subheading").editable({type:"text",title:"Title",success:function(e,t){a.setProperty("subheading",t)}}),$("#"+t+" p.description").editable({type:"textarea",title:"Description",success:function(e,t){a.setProperty("description",t)}})}function a(e){var t=e.getProperty("dateTime"),a=e.getProperty("subheading"),o=e.getProperty("description");return{dateTime:"undefined"!=typeof t&&t?moment(t).format("MMMM Do YYYY, h:mm a"):moment().format("MMMM Do YYYY, h:mm a"),subheading:"undefined"!=typeof a&&a?a:"Click to edit the title",description:"undefined"!=typeof o&&o?o:"Click edit the description"}}function o(e){return{id:e,properties:{},feature:{},styles:{id:"event-"+e,count:e%2?"event-count":"event-count-inverted",timeline:e%2?"":"timeline-inverted"}}}function i(t){t.addListener("addfeature",function(t){var i=t.feature,r=i.getGeometry().getType(),s=m,l={};"Point"==r&&(m++,d.data.overrideStyle(i,{icon:"https://chart.googleapis.com/chart?chst=d_map_spin&chld=1|0|fed136|13|_|"+m}),l=o(s),l.properties=a(i),l.feature=i,e(l)),n()}),t.addListener("setproperty",n),t.addListener("removefeature",n),t.addListener("setgeometry",n)}function n(){d.data.toGeoJson(function(e){e.features.forEach(function(e,t){e.id=t}),localStorage.setItem("geoData",JSON.stringify(e))})}function r(e){var t=JSON.parse(localStorage.getItem("geoData"));e.data.forEach(function(t){e.data.remove(t)}),e.data.addGeoJson(t)}var d,s,l,p,m=0,c={draggable:!0,scrollwheel:!1,streetViewControl:!1,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.ROADMAP]},mapTypeId:google.maps.MapTypeId.SATELLITE};s=document.getElementById("location-map"),l=parseFloat(s.dataset.lat),p=parseFloat(s.dataset.lng),d=new google.maps.Map(s,c),d.setCenter({lat:l,lng:p}),d.setZoom(12),d.data.setControlPosition(google.maps.ControlPosition.TOP_RIGHT),d.data.setControls(["LineString","Point"]),d.data.setStyle({editable:!0,draggable:!0}),i(d.data),r(d)});