$(document).ready(function(){function e(e,t,o){var n=new google.maps.InfoWindow({content:o});n.open(e,t)}function t(e){var t=e.lat(),o=e.lng();$("#latitude")[0].value=t,$("#longitude")[0].value=o,$("#display-latitude").text(t),$("#display-longitude").text(o)}function o(e){var t=n();return t?t:e.getCenter()}function n(){var e=$("input#latitude").attr("value"),t=$("input#longitude").attr("value");return e&&t?new google.maps.LatLng(e,t):!1}function a(){var e=$("input#latitude").attr("value"),t=$("input#longitude").attr("value");e&t&&($("#display-latitude").text(e),$("#display-longitude").text(t))}function g(){return n()?n():{lat:53.4807593,lng:-2.2426305000000184}}function l(e){var t=e.getBounds(),o=t.getNorthEast(),n=t.getSouthWest();return[n.lat(),n.lng(),o.lat(),o.lng()]}function r(e){$.ajax({type:"GET",url:"/search",data:{bounds:e},contentType:"application/json; charset=utf-8",dataType:"json",success:s,failure:function(e){alert(e)}})}function s(e){var t=e.markers;u(t)}function u(e){for(d(),i=0;i<e.length;i++){markerCount=i,markerCount++;var t=new google.maps.LatLng(e[i].latitude,e[i].longitude),o=new google.maps.Marker({position:t,label:markerCount.toString(),map:p});o.setMap(p),v.push(o)}}function d(){for(var e=0;e<v.length;e++)v[e].setMap(null);v=[]}var p,c,m,f,v=[],y={scrollwheel:!1,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.LEFT_BOTTOM,mapTypeIds:[google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.ROADMAP]}};p=new google.maps.Map(document.getElementById("map"),y),p.setCenter(g()),p.setZoom(10),m=document.getElementById("map-search-box"),p.controls[google.maps.ControlPosition.TOP_LEFT].push(m),c=new google.maps.places.SearchBox(m),a(),google.maps.event.addListenerOnce(p,"idle",function(){f=new google.maps.Marker({position:o(p),map:p,draggable:!0}),e(p,f,content="Drag and drop this marker onto the water you'd like to add."),boundingBox=l(p),r(boundingBox),t(f.getPosition()),google.maps.event.addListener(f,"drag",function(){t(f.getPosition())}),google.maps.event.addListener(p,"dragend",function(){var e=p.getCenter();f.setPosition(e),t(f.getPosition()),boundingBox=l(p),r(boundingBox)}),google.maps.event.addListener(p,"zoom_changed",function(){var e=p.getCenter();f.setPosition(e),boundingBox=l(p),r(boundingBox)}),google.maps.event.addListener(c,"places_changed",function(){var e=c.getPlaces();if(!(e.length<=0)){var o=e[0],n=new google.maps.LatLngBounds;n.extend(o.geometry.location),p.fitBounds(n),p.setZoom(10),boundingBox=l(p),r(boundingBox),t(f.getPosition())}})})});