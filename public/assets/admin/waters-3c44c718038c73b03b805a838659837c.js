$(document).ready(function(){function t(t){var e=t.lat(),o=t.lng();$("#latitude")[0].value=e,$("#longitude")[0].value=o,$("#display-latitude").text(e),$("#display-longitude").text(o)}function e(t){var e=o();return e?e:t.getCenter()}function o(){var t=$("input#latitude").attr("value"),e=$("input#longitude").attr("value");return t&&e?new google.maps.LatLng(t,e):!1}function n(){var t=$("input#latitude").attr("value"),e=$("input#longitude").attr("value");t&e&&($("#display-latitude").text(t),$("#display-longitude").text(e))}function a(){return o()?o():{lat:53.4807593,lng:-2.2426305000000184}}function g(t){var e=t.getBounds(),o=e.getNorthEast(),n=e.getSouthWest();return[n.lat(),n.lng(),o.lat(),o.lng()]}function l(t){$.ajax({type:"GET",url:"/search",data:{bounds:t},contentType:"application/json; charset=utf-8",dataType:"json",success:s,failure:function(t){alert(t)}})}function s(t){var e=t.markers;r(e)}function r(t){for(u(),i=0;i<t.length;i++){markerCount=i,markerCount++;var e=new google.maps.LatLng(t[i].latitude,t[i].longitude),o=new google.maps.Marker({position:e,label:markerCount.toString(),map:d});o.setMap(d),f.push(o)}}function u(){for(var t=0;t<f.length;t++)f[t].setMap(null);f=[]}var d,p,c,m,f=[],v={scrollwheel:!1,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.LEFT_BOTTOM,mapTypeIds:[google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.ROADMAP]}};d=new google.maps.Map(document.getElementById("map"),v),d.setCenter(a()),d.setZoom(10),c=document.getElementById("map-search-box"),d.controls[google.maps.ControlPosition.TOP_LEFT].push(c),p=new google.maps.places.SearchBox(c),n(),google.maps.event.addListenerOnce(d,"idle",function(){m=new google.maps.Marker({position:e(d),icon:"https://chart.googleapis.com/chart?chst=d_map_spin&chld=1|0|fed136|13|_|",map:d,draggable:!0}),boundingBox=g(d),l(boundingBox),t(m.getPosition()),google.maps.event.addListener(m,"drag",function(){t(m.getPosition())}),google.maps.event.addListener(d,"dragend",function(){var e=d.getCenter();m.setPosition(e),t(m.getPosition()),boundingBox=g(d),l(boundingBox)}),google.maps.event.addListener(d,"zoom_changed",function(){var t=d.getCenter();m.setPosition(t),boundingBox=g(d),l(boundingBox)}),google.maps.event.addListener(p,"places_changed",function(){var e=p.getPlaces();if(!(e.length<=0)){var o=e[0],n=new google.maps.LatLngBounds;n.extend(o.geometry.location),d.fitBounds(n),d.setZoom(10),boundingBox=g(d),l(boundingBox),t(m.getPosition())}})})});